{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/ivan_romero/Proyecto_personal/wow/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { RaidbotsApiService } from '../services/raidbots-api.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"../services/raidbots-api.service\";\nimport * as i3 from \"../services/local-data.service\";\nimport * as i4 from \"../services/discord-api.service\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/forms\";\nimport * as i8 from \"ng2-charts\";\nconst _c0 = [\"myselect\"];\n\nfunction MainComponent_span_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 6);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\"\", ctx_r0.actualSpec, \" \\u00B7 ilvl \", ctx_r0.actualIlvl, \"\");\n  }\n}\n\nfunction MainComponent_span_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 6);\n    i0.ɵɵtext(1, \"Ranking: 1\\u00BA verde oscuro \\u00B7 2\\u00BA \\u00E1mbar \\u00B7 3\\u00BA cobre\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction MainComponent_option_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const boss_r11 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", boss_r11.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(boss_r11.name);\n  }\n}\n\nfunction MainComponent_select_21_option_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const slot_r14 = ctx.$implicit;\n    const ctx_r13 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"value\", slot_r14);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r13.formatMainSlotLabel(slot_r14));\n  }\n}\n\nfunction MainComponent_select_21_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"select\", 23, 10);\n    i0.ɵɵlistener(\"change\", function MainComponent_select_21_Template_select_change_0_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r15.filtrar2($event));\n    });\n    i0.ɵɵelementStart(2, \"option\", 11);\n    i0.ɵɵtext(3, \"Slots\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, MainComponent_select_21_option_4_Template, 2, 2, \"option\", 12);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.listSlots);\n  }\n}\n\nfunction MainComponent_select_22_option_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const dps_r19 = ctx.$implicit;\n    const ctx_r18 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"value\", dps_r19);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r18.formatDpsLabel(dps_r19));\n  }\n}\n\nfunction MainComponent_select_22_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r21 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"select\", 24, 10);\n    i0.ɵɵlistener(\"change\", function MainComponent_select_22_Template_select_change_0_listener($event) {\n      i0.ɵɵrestoreView(_r21);\n      const ctx_r20 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r20.filtrar4($event));\n    });\n    i0.ɵɵelementStart(2, \"option\", 11);\n    i0.ɵɵtext(3, \"DPS\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, MainComponent_select_22_option_4_Template, 2, 2, \"option\", 12);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r5.dpsThresholds);\n  }\n}\n\nfunction MainComponent_select_23_option_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const player_r24 = ctx.$implicit;\n    const ctx_r23 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"value\", player_r24.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r23.capitalizeFirstLetter(player_r24.name));\n  }\n}\n\nfunction MainComponent_select_23_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r26 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"select\", 25, 10);\n    i0.ɵɵlistener(\"change\", function MainComponent_select_23_Template_select_change_0_listener($event) {\n      i0.ɵɵrestoreView(_r26);\n      const ctx_r25 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r25.filtrar3($event));\n    });\n    i0.ɵɵelementStart(2, \"option\", 11);\n    i0.ɵɵtext(3, \"Players\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, MainComponent_select_23_option_4_Template, 2, 2, \"option\", 12);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r6.playersLibrary);\n  }\n}\n\nfunction MainComponent_button_27_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r28 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 17);\n    i0.ɵɵlistener(\"click\", function MainComponent_button_27_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r28);\n      const ctx_r27 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r27.cargarRutaDroptimizer());\n    });\n    i0.ɵɵtext(1, \"Droptimizer\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction MainComponent_button_28_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r30 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 17);\n    i0.ɵɵlistener(\"click\", function MainComponent_button_28_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r30);\n      const ctx_r29 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r29.getRotation());\n    });\n    i0.ɵɵtext(1, \"Rotacion\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction MainComponent_section_31_ng_container_1_ng_container_1_article_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"article\", 30)(1, \"div\", 31);\n    i0.ɵɵelement(2, \"img\", 32);\n    i0.ɵɵelementStart(3, \"div\", 33)(4, \"h3\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(8, \"div\", 34);\n    i0.ɵɵelement(9, \"canvas\", 35);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const item_r35 = ctx.$implicit;\n    const slot_r32 = i0.ɵɵnextContext(2).$implicit;\n    const ctx_r34 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"src\", ctx_r34.getImgLink(item_r35.id), i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r34.capitalizeFirstLetter(slot_r32[0]));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"\", ctx_r34.getBoss(item_r35.boss), \" \\u00B7 \", item_r35.armor || \"Any Armor\", \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"data\", ctx_r34.getChartData(item_r35.id))(\"options\", ctx_r34.getCharOptions(item_r35))(\"type\", \"bar\");\n  }\n}\n\nfunction MainComponent_section_31_ng_container_1_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, MainComponent_section_31_ng_container_1_ng_container_1_article_1_Template, 10, 7, \"article\", 29);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const slot_r32 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", slot_r32[1]);\n  }\n}\n\nfunction MainComponent_section_31_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, MainComponent_section_31_ng_container_1_ng_container_1_Template, 2, 1, \"ng-container\", 28);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const slot_r32 = ctx.$implicit;\n    const ctx_r31 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r31.quitarVacios(slot_r32));\n  }\n}\n\nfunction MainComponent_section_31_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"section\", 26);\n    i0.ɵɵtemplate(1, MainComponent_section_31_ng_container_1_Template, 2, 1, \"ng-container\", 27);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r9 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r9.fitems);\n  }\n}\n\nconst _c1 = function (a0, a1) {\n  return {\n    \"background-color\": a0,\n    \"color\": a1\n  };\n};\n\nfunction MainComponent_section_32_article_1_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 40);\n    i0.ɵɵelement(1, \"img\", 32);\n    i0.ɵɵelementStart(2, \"span\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const item_r41 = ctx.$implicit;\n    const ctx_r40 = i0.ɵɵnextContext(3);\n    i0.ɵɵproperty(\"ngStyle\", i0.ɵɵpureFunction2(3, _c1, ctx_r40.getColor(item_r41.pos), ctx_r40.getRotacionBis(item_r41)));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", ctx_r40.getImgLink(item_r41.item), i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r41.name);\n  }\n}\n\nfunction MainComponent_section_32_article_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"article\", 38);\n    i0.ɵɵtemplate(1, MainComponent_section_32_article_1_div_1_Template, 4, 6, \"div\", 39);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const player_r39 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", player_r39);\n  }\n}\n\nfunction MainComponent_section_32_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"section\", 36);\n    i0.ɵɵtemplate(1, MainComponent_section_32_article_1_Template, 2, 1, \"article\", 37);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r10 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r10.allSimList);\n  }\n}\n\nexport let MainComponent = /*#__PURE__*/(() => {\n  class MainComponent {\n    constructor(http, RaidbotsApiService, LocalDataService, DiscordApiService, router) {\n      this.http = http;\n      this.RaidbotsApiService = RaidbotsApiService;\n      this.LocalDataService = LocalDataService;\n      this.DiscordApiService = DiscordApiService;\n      this.router = router;\n      this._bossesURL = 'assets/json/vault_incarnates.json';\n      this.bosses = [];\n      this.items = {\n        head: [],\n        neck: [],\n        shoulder: [],\n        back: [],\n        chest: [],\n        wrist: [],\n        hands: [],\n        waist: [],\n        legs: [],\n        feet: [],\n        finger: [],\n        trinket: [],\n        main_hand: [],\n        off_hand: []\n      };\n      this.listSlots = ['head', 'neck', 'shoulder', 'back', 'chest', 'wrist', 'hands', 'waist', 'legs', 'feet', 'finger', 'trinket', 'main_hand', 'off_hand'];\n      this.aitems = [];\n      this.fitems = [];\n      this.base_url = 'https://www.raidbots.com/simbot/report/';\n      this.reports = [];\n      this.listBosses = [];\n      this.itemsLibrary = [];\n      this.PH_image = 'https://wow.zamimg.com/images/wow/icons/large/inv_10_jewelcrafting_gem3primal_fire_cut_blue.jpg';\n      this.base_img = 'https://wow.zamimg.com/images/wow/icons/large/';\n      this.encounterLibrary = [];\n      this.playersLibrary = [];\n      this.playerCargado = '';\n      this.bossCargado = '';\n      this.checkDiv = false;\n      this.checkArray = [];\n      this.actualIlvl = 0;\n      this.actualSpec = '';\n      this.YOUR_AUTHORIZATION_CODE = 'kXnSmYA60XPENHCp83XlLNY3fwOojI';\n      this.allSimList = [];\n      this.allBisList = [];\n      this.dpsThresholds = [];\n      this.tierSlots = [];\n      this.tierEncounterIds = new Set();\n      this.tierItemIds = new Set();\n      this.ignoredTierEncounterIds = new Set();\n      this.encounterAliases = {};\n      this.droptimizerMetaByReport = {}; // TODO: desactivar en cuanto se vuelva al flujo real por TXT/URL.\n\n      this.useMockDroptimizer = true;\n      this.weekRangeLabel = '';\n\n      this.transformObjectGear = obj => {\n        const transformed = {};\n\n        for (const key in obj) {\n          const {\n            encoded_item,\n            ilevel\n          } = obj[key]; // Extraer el ID usando una expresión regular\n\n          const idMatch = encoded_item.match(/id=(\\d+)/);\n          const id = idMatch ? parseInt(idMatch[1], 10) : null;\n\n          if (id) {\n            transformed[key] = {\n              id,\n              ilevel\n            };\n          }\n        }\n\n        return transformed;\n      };\n    }\n\n    getJSON(url) {\n      return this.http.get(url);\n    }\n\n    ngOnInit() {\n      //this.getDiscord();\n      this.weekRangeLabel = this.getNearestWednesdayToTuesdayRange();\n      this.loadTierTokenMetadata();\n    }\n\n    getNearestWednesdayToTuesdayRange() {\n      const now = new Date();\n      const day = now.getDay(); // 0 Sunday ... 3 Wednesday\n\n      const daysSinceWednesday = (day - 3 + 7) % 7;\n      const start = new Date(now);\n      start.setDate(now.getDate() - daysSinceWednesday);\n      const end = new Date(start);\n      end.setDate(start.getDate() + 6);\n      return `${this.formatDateDDMM(start)} - ${this.formatDateDDMM(end)}`;\n    }\n\n    formatDateDDMM(date) {\n      const dd = String(date.getDate()).padStart(2, '0');\n      const mm = String(date.getMonth() + 1).padStart(2, '0');\n      return `${dd}/${mm}`;\n    }\n\n    loadTierTokenMetadata() {\n      this.RaidbotsApiService.getItemList().subscribe({\n        next: items => {\n          if (Array.isArray(items)) {\n            items.forEach(item => {\n              if (!Array.isArray(item.contains) || item.contains.length === 0) {\n                return;\n              }\n\n              if (item.itemClass !== 15 || item.itemSubClass !== 0) {\n                return;\n              }\n\n              const source = item.sources?.[0];\n\n              if (!source?.encounterId || source.encounterId <= 0) {\n                return;\n              }\n\n              const isUniversalToken = item.contains.length > 20;\n\n              if (isUniversalToken) {\n                this.ignoredTierEncounterIds.add(Number(source.encounterId));\n                return;\n              }\n\n              this.tierEncounterIds.add(Number(source.encounterId));\n              item.contains.forEach(id => this.tierItemIds.add(Number(id)));\n            });\n          }\n\n          this.getTxt();\n        },\n        error: () => {\n          // Fallback: la app sigue funcionando aunque no podamos cargar metadatos dinámicos.\n          this.getTxt();\n        }\n      });\n    }\n\n    getDiscord() {\n      var _this = this;\n\n      return _asyncToGenerator(function* () {\n        yield _this.DiscordApiService.getAuthorize(_this.YOUR_AUTHORIZATION_CODE);\n\n        _this.DiscordApiService.getMensajes('1006082307641319455').subscribe(data => {\n          console.log('Mensajes obtenidos:', data);\n        }, error => {\n          console.error('Error al obtener los mensajes:', error);\n        });\n      })();\n    }\n\n    getTxt() {\n      if (this.useMockDroptimizer) {\n        this.loadMockDroptimizer();\n        return;\n      }\n\n      this.getBisListData();\n      this.LocalDataService.getDroptimizers().subscribe(data => {\n        var str = data.split(/[\\r\\n\\s]+/);\n        str.forEach(element => {\n          this.getReports(element);\n        });\n        this.reports.forEach(report => {\n          this.RaidbotsApiService.getDroptimizer(report).subscribe(data => {\n            this.processDroptimizerData(data, report);\n          });\n        });\n      });\n    }\n\n    loadMockDroptimizer() {\n      this.getBisListData();\n      const mockReportId = 'report/mock-manaforge-omega';\n      this.reports = [mockReportId];\n      this.http.get('assets/json/mock-droptimizer-manaforge.json').subscribe(data => {\n        this.processDroptimizerData(data, mockReportId);\n      });\n    }\n\n    processDroptimizerData(data, report) {\n      this.droptimizerMetaByReport[report] = this.extractDroptimizerMeta(data);\n\n      if (this.encounterLibrary.length == 0) {\n        this.getBossLibrary(data);\n      }\n\n      this.addPlayer(data, report);\n      this.playersLibrary.sort((a, b) => a.name.localeCompare(b.name));\n      this.getItemsLibrary(data);\n      this.getDroptimizer(data);\n      this.getBisListData();\n      this.cargarTiersPlayer();\n    }\n\n    addPlayer(data, report) {\n      const _url = `https://www.raidbots.com/simbot/${report}/`;\n      var player = data.sim.players[0].name;\n      var spec = data.sim.players[0].specialization;\n      var existe = this.playersLibrary.find(x => x.name.toLowerCase() == player.toLowerCase());\n      var gear = data.sim.players[0].gear;\n      var ilvl = this.calcularIlvl(gear);\n      var gearIlvl = this.calcularGearIlvl(gear);\n\n      if (!existe) {\n        this.playersLibrary.push({\n          name: player,\n          ilvl: ilvl,\n          spec: spec,\n          gear: gear,\n          gearIlvl: gearIlvl,\n          report: _url\n        });\n      } else {\n        var existeIlvl = existe.ilvl;\n\n        if (ilvl > existeIlvl) {\n          this.playersLibrary.find(x => x.name.toLowerCase() == player.toLowerCase()).ilvl = ilvl;\n        }\n      }\n    }\n\n    calcularGearIlvl(gear) {\n      const resultado = Object.keys(gear).map(key => ({\n        name: key,\n        value: gear[key]['ilevel']\n      }));\n      return resultado;\n    }\n\n    calcularIlvl(gear) {\n      var total = 0;\n      var cont = 0;\n      var temp = 0;\n      Object.values(gear).forEach((value, index) => {\n        total += value.ilevel;\n        cont++;\n        temp = value.ilevel;\n      });\n\n      if (cont == 15) {\n        total += temp;\n      }\n\n      total = total / 16;\n      total = Math.round(total * 100) / 100;\n      return total;\n    }\n\n    getBossLibrary(data) {\n      var bosses = data.simbot.meta.itemLibrary[0].instance.encounters;\n      const realBosses = bosses.filter(enc => !this.isPseudoEncounter(enc?.name));\n      const finalRealBoss = realBosses.length > 0 ? realBosses[realBosses.length - 1] : null;\n      bosses.forEach(element => {\n        if (this.isPseudoEncounter(element?.name)) {\n          if (finalRealBoss) {\n            const fromId = Number(element.id);\n            const toId = Number(finalRealBoss.id);\n            this.encounterAliases[fromId] = toId;\n\n            if (this.tierEncounterIds.has(fromId)) {\n              this.tierEncounterIds.add(toId);\n            }\n\n            if (this.ignoredTierEncounterIds.has(fromId)) {\n              this.ignoredTierEncounterIds.add(toId);\n            }\n          }\n\n          return;\n        }\n\n        var boss = {\n          id: element.id,\n          name: element.name\n        };\n        this.encounterLibrary.push(boss);\n      });\n    }\n\n    getItemsLibrary(data) {\n      var library = data.simbot.meta.itemLibrary;\n      library.forEach(item => {\n        var existe = false;\n        this.itemsLibrary.forEach(element => {\n          if (item.id == element.id) {\n            existe = true;\n          }\n        });\n\n        if (!existe) {\n          var itemReal = {\n            id: item.id,\n            name: item.name,\n            icon: item.icon,\n            boss: item.encounter.id,\n            stats: item.stats\n          };\n          this.itemsLibrary.push(itemReal);\n        } else {\n          if (this.comprobarTierItem(item)) {\n            const existingItem = this.itemsLibrary.find(element => element.id === item.id);\n\n            if (existingItem) {\n              existingItem.boss = item.encounter.id;\n            }\n          }\n        }\n      });\n    }\n\n    getReports(txt) {\n      var str = txt.split(\"https://www.raidbots.com/simbot/report/\");\n\n      if (str.length > 1) {\n        //var url = this.base_url + str[1] + '/';\n        var url = \"report/\" + str[1];\n        this.reports.push(url);\n      }\n    }\n\n    getDroptimizer(data) {\n      var sim = data.sim;\n      var nombre = this.capitalizeFirstLetter(sim.players[0].name);\n      var spec = sim.players[0].specialization;\n      var actualDPS = Math.round(sim.statistics.raid_dps.mean);\n      var player = {\n        name: nombre,\n        spec: spec,\n        dps: actualDPS\n      };\n      var results = sim.profilesets.results;\n      results.forEach(element => {\n        this.getItem(element, player);\n      });\n      this.aitems = Object.entries(this.items);\n      this.aitems.forEach(element => {\n        this.comprobarDuplicados(element[1]);\n      });\n      this.aitems = Object.entries(this.items);\n      this.aitems = this.comprobarCatalyst(this.aitems);\n      this.fitems = this.aitems;\n      this.updateDpsThresholds(this.fitems);\n    }\n\n    quitarVacios(slot) {\n      if (slot[1] && slot[1] == '') {\n        return false;\n      }\n\n      return true;\n    }\n\n    getItem(item, player) {\n      var str = item.name.split(\"/\", 7);\n      var item_id = str[3];\n      const numericItemId = Number(item_id);\n      var item_boss = this.normalizeEncounterId(str[1]);\n      var item_slot = this.comprobarSlot(str[6]);\n      var item_dps = Math.round(item.mean);\n      var item_realDPS = item_dps - player.dps;\n      var item_armor = this.getArmor(player.spec, item_slot);\n\n      if (this.isTierSlot(item_slot) && this.ignoredTierEncounterIds.has(Number(item_boss))) {\n        return;\n      }\n\n      var tier = this.comprobarTier(item_boss, item_slot, player.spec, numericItemId);\n      var item_exactID = -1;\n\n      if (tier != -1) {\n        item_exactID = item_id;\n        item_id = `${item_boss}${tier}`;\n        item_armor = 'Tier';\n      }\n\n      if (item_realDPS > 0) {\n        const simItemId = tier !== -1 ? Number(item_exactID) : numericItemId;\n        var simC = {\n          name: player.name,\n          spec: player.spec,\n          dps: item_realDPS,\n          itemId: simItemId\n        };\n        var allItems = this.items[item_slot];\n        var existe = false;\n\n        if (allItems) {\n          allItems.forEach(element => {\n            if (element) {\n              if (element.id == item_id) {\n                existe = true;\n\n                if (item_exactID != -1) {\n                  if (!element.exactID) {\n                    element.exactID = [];\n                  } else {\n                    element.exactID.push(Number(item_exactID));\n                  }\n                }\n\n                if (!element.sim) {\n                  element.sim = [];\n                }\n\n                element.sim.push(simC);\n              }\n            }\n          });\n        }\n\n        ;\n\n        if (existe == false) {\n          var item_descrip = {\n            id: item_id,\n            armor: item_armor,\n            tier: -1,\n            exactID: [],\n            boss: item_boss,\n            sim: [simC]\n          };\n\n          if (tier != -1) {\n            item_descrip.tier = tier;\n\n            if (item_exactID != -1) {\n              item_descrip.exactID.push(Number(item_exactID));\n            }\n\n            item_descrip.id = `${item_boss}${tier}`;\n          }\n\n          if (allItems) {\n            allItems.push(item_descrip);\n          }\n        }\n      }\n    }\n\n    comprobarDuplicados(items) {\n      items.forEach(item => {\n        var sim = item.sim;\n\n        if (sim.length > 1) {\n          var realSim = [];\n          sim.forEach(simC => {\n            var existe = false;\n            realSim.forEach(data => {\n              if (simC.name == data.name) {\n                existe = true;\n\n                if (simC.dps > data.dps) {\n                  data.dps = simC.dps;\n                }\n              }\n            });\n\n            if (!existe) {\n              realSim.push(simC);\n            }\n          });\n          item.sim = realSim;\n        }\n      });\n    }\n\n    comprobarTierItem(item, slot) {\n      const bossId = Number(item?.encounter?.id ?? item?.boss ?? -1);\n      const itemId = Number(item?.id ?? -1);\n      const resolvedSlot = slot || this.getSlotFromIcon(item?.icon);\n      return this.comprobarTier(bossId, resolvedSlot, '', itemId) !== -1;\n    }\n\n    comprobarTier(boss, slot, spec, itemId) {\n      if (!this.isTierSlot(slot)) {\n        return -1;\n      }\n\n      const bossId = Number(boss);\n\n      if (this.tierEncounterIds.size > 0 && !this.tierEncounterIds.has(bossId)) {\n        return -1;\n      }\n\n      if (typeof itemId === 'number' && this.tierItemIds.size > 0 && !this.tierItemIds.has(Number(itemId))) {\n        return -1;\n      }\n\n      if (!spec) {\n        return 0;\n      }\n\n      return this.getTier(spec);\n    }\n\n    isTierSlot(slot) {\n      return slot == 'head' || slot == 'shoulder' || slot == 'chest' || slot == 'hands' || slot == 'legs';\n    }\n\n    getSlotFromIcon(icon) {\n      if (!icon) {\n        return '';\n      }\n\n      if (icon.includes('helm')) {\n        return 'head';\n      }\n\n      if (icon.includes('pant')) {\n        return 'legs';\n      }\n\n      if (icon.includes('shoulder')) {\n        return 'shoulder';\n      }\n\n      if (icon.includes('chest')) {\n        return 'chest';\n      }\n\n      if (icon.includes('glove')) {\n        return 'hands';\n      }\n\n      return '';\n    }\n\n    isPseudoEncounter(name) {\n      if (!name) {\n        return false;\n      }\n\n      return String(name).toLowerCase().includes('loot core');\n    }\n\n    normalizeEncounterId(encounterId) {\n      const numericId = Number(encounterId);\n      return this.encounterAliases[numericId] ?? numericId;\n    }\n\n    extractDroptimizerMeta(data) {\n      const sim = data?.sim ?? {};\n      const serialized = JSON.stringify({\n        options: sim?.options ?? {},\n        profile: sim?.profile ?? {},\n        profileSets: sim?.profilesets ?? {}\n      }).toLowerCase();\n      let difficulty = 'unknown';\n\n      if (serialized.includes('mythic')) {\n        difficulty = 'mythic';\n      } else if (serialized.includes('heroic')) {\n        difficulty = 'heroic';\n      } else if (serialized.includes('normal')) {\n        difficulty = 'normal';\n      }\n\n      const hasUpgrades = serialized.includes('upgrade') || serialized.includes('crest') || serialized.includes('track=');\n      const hasCatalyst = serialized.includes('catalyst') || serialized.includes('encounterid=-67');\n      return {\n        difficulty,\n        hasUpgrades,\n        hasCatalyst\n      };\n    }\n\n    comprobarSlot(slot) {\n      if (slot == 'trinket1') {\n        return 'trinket';\n      }\n\n      if (slot == 'trinket2') {\n        return 'trinket';\n      }\n\n      if (slot == 'finger1') {\n        return 'finger';\n      }\n\n      if (slot == 'finger2') {\n        return 'finger';\n      }\n\n      return slot;\n    }\n\n    getBoss(id) {\n      var retorna = 'Trash Drop';\n      const normalizedId = this.normalizeEncounterId(id);\n      this.encounterLibrary.forEach(element => {\n        var element_id = element.id;\n\n        if (normalizedId == element_id) {\n          retorna = element.name;\n        }\n      });\n      return retorna;\n    }\n\n    sortChart(items) {\n      var sorted = items.sort((a, b) => a.dps > b.dps ? -1 : 1);\n      return sorted;\n    }\n\n    getChartData(id) {\n      var items = Object.entries(this.items);\n      var chart_names = [];\n      var chart_dps = [];\n      var chart_color = [];\n      items.forEach(element => {\n        var e = element[1];\n        e.forEach(slot => {\n          if (slot.id == id) {\n            var slots = this.sortChart(slot.sim);\n            slots.forEach(slot => {\n              chart_names.push(slot.name);\n              chart_dps.push(slot.dps);\n              chart_color.push(this.generateColor(slot.spec));\n            });\n          }\n        });\n      });\n      var barChartData = {\n        labels: chart_names,\n        datasets: [{\n          data: chart_dps,\n          label: '',\n          backgroundColor: chart_color\n        }]\n      };\n      return barChartData;\n    }\n\n    quitarVacioSpec(spec) {\n      var palabras = spec.split(\" \");\n\n      if (palabras.length > 2) {\n        if (palabras[0] == 'Beast') {\n          return 'Beast-Mastery Hunter';\n        }\n\n        var cadena = palabras[0] + \" \" + palabras[1] + \"-\" + palabras[2];\n        return cadena;\n      }\n\n      return spec;\n    }\n\n    buscarCatalyst(id) {\n      var idList = [id];\n      const result = this.aitems.flatMap(item => item[1]).find(x => x.exactID == id);\n\n      if (result !== undefined) {\n        idList.push(result.id);\n      }\n\n      const result2 = this.aitems.flatMap(item => item[1]).find(x => x.id == id);\n\n      if (result2 !== undefined) {\n        if (result2.exactID[0] !== undefined) {\n          idList.push(result2.exactID[0]);\n        }\n      }\n\n      return idList;\n    }\n\n    getCharOptions(item) {\n      var colors = [];\n      var sim = item.sim;\n      const fallbackItemId = Number(item.id);\n      const exactIds = Array.isArray(item.exactID) ? item.exactID.map(x => Number(x)).filter(x => !Number.isNaN(x)) : [];\n      sim.forEach(element => {\n        var spec = this.quitarVacioSpec(element.spec);\n        var bisList = this.allBisList.find(x => x[0] == spec);\n\n        if (bisList) {\n          const candidateIds = [Number(element.itemId), ...exactIds, fallbackItemId].filter(x => Number.isInteger(x) && x > 0);\n          const existe = candidateIds.some(candidateId => bisList.some(x => Number(x) === candidateId));\n\n          if (!existe) {\n            colors.push('red');\n          } else {\n            colors.push('white');\n          }\n        } else {\n          colors.push('white');\n        }\n      });\n      var barChartOptions = {\n        scales: {\n          x: {\n            ticks: {\n              color: function (context) {\n                const index = context.index;\n                return colors[index % colors.length];\n              }\n            }\n          }\n        },\n        plugins: {\n          legend: {\n            display: false\n          }\n        }\n      };\n      return barChartOptions;\n    }\n\n    generateColor(spec) {\n      if (spec == 'Devastation Evoker' || spec == 'Augmentation Evoker') {\n        return '#33937f';\n      }\n\n      if (spec == 'Balance Druid' || spec == 'Feral Druid' || spec == 'Guardian Druid') {\n        return '#ff7d0a';\n      }\n\n      if (spec == 'Unholy Death Knight' || spec == 'Frost Death Knight' || spec == 'Blood Death Knight') {\n        return '#c41f3b';\n      }\n\n      if (spec == 'Havoc Demon Hunter' || spec == 'Vengeance Demon Hunter') {\n        return '#a330c9';\n      }\n\n      if (spec == 'Beast Mastery Hunter' || spec == 'Marksmanship Hunter' || spec == 'Survival Hunter') {\n        return '#abd473';\n      }\n\n      if (spec == 'Enhancement Shaman' || spec == 'Elemental Shaman') {\n        return '#0070de';\n      }\n\n      if (spec == 'Assassination Rogue' || spec == 'Outlaw Rogue' || spec == 'Subtlety Rogue') {\n        return '#e6d600';\n      }\n\n      if (spec == 'Arcane Mage' || spec == 'Frost Mage' || spec == 'Fire Mage') {\n        return '#69ccf0';\n      }\n\n      if (spec == 'Windwalker Monk' || spec == 'Brewmaster Monk') {\n        return '#00ff96';\n      }\n\n      if (spec == 'Fury Warrior' || spec == 'Arms Warrior' || spec == 'Protection Warrior') {\n        return '#c79c6e';\n      }\n\n      if (spec == 'Affliction Warlock' || spec == 'Demonology Warlock' || spec == 'Destruction Warlock') {\n        return '#9482c9';\n      }\n\n      if (spec == 'Shadow Priest') {\n        return '#e8e6e3';\n      }\n\n      if (spec == 'Retribution Paladin' || spec == 'Protection Paladin') {\n        return '#f58cba';\n      }\n\n      return 'black';\n    }\n\n    getArmor(spec, slot) {\n      if (slot == 'trinket' || slot == 'finger' || slot == 'main_hand' || slot == 'off_hand' || slot == 'back' || slot == 'neck') {\n        return '';\n      }\n\n      if (spec == 'Devastation Evoker' || spec == 'Augmentation Evoker') {\n        return 'Mail';\n      }\n\n      if (spec == 'Balance Druid' || spec == 'Feral Druid' || spec == 'Guardian Druid') {\n        return 'Leather';\n      }\n\n      if (spec == 'Unholy Death Knight' || spec == 'Frost Death Knight' || spec == 'Blood Death Knight') {\n        return 'Plate';\n      }\n\n      if (spec == 'Havoc Demon Hunter' || spec == 'Vengeance Demon Hunter') {\n        return 'Leather';\n      }\n\n      if (spec == 'Beast Mastery Hunter' || spec == 'Marksmanship Hunter' || spec == 'Survival Hunter') {\n        return 'Mail';\n      }\n\n      if (spec == 'Enhancement Shaman' || spec == 'Elemental Shaman') {\n        return 'Mail';\n      }\n\n      if (spec == 'Assassination Rogue' || spec == 'Outlaw Rogue' || spec == 'Subtlety Rogue') {\n        return 'Leather';\n      }\n\n      if (spec == 'Arcane Mage' || spec == 'Frost Mage' || spec == 'Fire Mage') {\n        return 'Cloth';\n      }\n\n      if (spec == 'Windwalker Monk' || spec == 'Brewmaster Monk') {\n        return 'Leather';\n      }\n\n      if (spec == 'Fury Warrior' || spec == 'Arms Warrior' || spec == 'Protection Warrior') {\n        return 'Plate';\n      }\n\n      if (spec == 'Affliction Warlock' || spec == 'Demonology Warlock' || spec == 'Destruction Warlock') {\n        return 'Cloth';\n      }\n\n      if (spec == 'Shadow Priest') {\n        return 'Cloth';\n      }\n\n      if (spec == 'Retribution Paladin' || spec == 'Protection Paladin') {\n        return 'Plate';\n      }\n\n      return '';\n    }\n\n    getTier(spec) {\n      if (spec == 'Devastation Evoker' || spec == 'Augmentation Evoker') {\n        return 0;\n      }\n\n      if (spec == 'Balance Druid' || spec == 'Feral Druid' || spec == 'Guardian Druid') {\n        return 2;\n      }\n\n      if (spec == 'Unholy Death Knight' || spec == 'Frost Death Knight' || spec == 'Blood Death Knight') {\n        return 1;\n      }\n\n      if (spec == 'Havoc Demon Hunter' || spec == 'Vengeance Demon Hunter') {\n        return 1;\n      }\n\n      if (spec == 'Beast Mastery Hunter' || spec == 'Marksmanship Hunter' || spec == 'Survival Hunter') {\n        return 2;\n      }\n\n      if (spec == 'Enhancement Shaman' || spec == 'Elemental Shaman') {\n        return 3;\n      }\n\n      if (spec == 'Assassination Rogue' || spec == 'Outlaw Rogue' || spec == 'Subtlety Rogue') {\n        return 0;\n      }\n\n      if (spec == 'Arcane Mage' || spec == 'Frost Mage' || spec == 'Fire Mage') {\n        return 2;\n      }\n\n      if (spec == 'Windwalker Monk' || spec == 'Brewmaster Monk') {\n        return 0;\n      }\n\n      if (spec == 'Fury Warrior' || spec == 'Arms Warrior' || spec == 'Protection Warrior') {\n        return 0;\n      }\n\n      if (spec == 'Affliction Warlock' || spec == 'Demonology Warlock' || spec == 'Destruction Warlock') {\n        return 1;\n      }\n\n      if (spec == 'Shadow Priest') {\n        return 3;\n      }\n\n      if (spec == 'Retribution Paladin' || spec == 'Protection Paladin') {\n        return 3;\n      }\n\n      return -1;\n    }\n\n    capitalizeFirstLetter(string) {\n      return string.charAt(0).toUpperCase() + string.slice(1);\n    }\n\n    formatMainSlotLabel(slot) {\n      if (slot === 'main_hand') {\n        return 'Weapon';\n      }\n\n      if (slot === 'off_hand') {\n        return 'Offhand';\n      }\n\n      return this.capitalizeFirstLetter(slot);\n    }\n\n    updateDpsThresholds(itemsSource) {\n      const dpsValues = [];\n      (itemsSource || []).forEach(slot => {\n        (slot?.[1] || []).forEach(item => {\n          (item?.sim || []).forEach(sim => {\n            const value = Number(sim?.dps);\n\n            if (Number.isFinite(value) && value > 0) {\n              dpsValues.push(value);\n            }\n          });\n        });\n      });\n\n      if (dpsValues.length === 0) {\n        this.dpsThresholds = [];\n        return;\n      }\n\n      const maxDps = Math.max(...dpsValues);\n      const percentages = [0.2, 0.4, 0.6, 0.8, 1];\n      const thresholds = percentages.map(p => this.roundDpsThreshold(maxDps * p)).filter(n => n > 0);\n      this.dpsThresholds = [...new Set(thresholds)].sort((a, b) => a - b);\n    }\n\n    roundDpsThreshold(value) {\n      if (value >= 10000) {\n        return Math.round(value / 1000) * 1000;\n      }\n\n      if (value >= 2000) {\n        return Math.round(value / 500) * 500;\n      }\n\n      return Math.max(100, Math.round(value / 100) * 100);\n    }\n\n    formatDpsLabel(value) {\n      if (!Number.isFinite(value)) {\n        return '';\n      }\n\n      if (value >= 1000) {\n        const k = value / 1000;\n        const formatted = Number.isInteger(k) ? `${k}` : k.toFixed(1).replace(/\\.0$/, '');\n        return `${formatted}k`;\n      }\n\n      return `${Math.round(value)}`;\n    }\n\n    filtrar(data) {\n      var boss = data.target.value;\n      this.playerCargado = '';\n      this.bossCargado = boss;\n\n      if (this.checkDiv) {\n        this.getRotation();\n      } else {\n        this.actualIlvl = 0;\n        this.checkDiv = false;\n\n        if (boss) {\n          this.fitems = this.aitems;\n          var titems = [];\n          this.fitems.forEach(element => {\n            var tslot = [];\n\n            if (element[1]) {\n              var bosses = element[1];\n              bosses.forEach(item => {\n                if (item.boss == boss) {\n                  tslot.push(item);\n                }\n              });\n              titems.push([element[0], tslot]);\n            }\n          });\n          this.fitems = titems;\n        } else {\n          this.fitems = this.aitems;\n        }\n\n        this.updateDpsThresholds(this.fitems);\n      }\n    }\n\n    filtrar2(data) {\n      this.actualIlvl = 0;\n      var slot = data.target.value;\n      this.playerCargado = '';\n      this.bossCargado = '';\n      this.checkDiv = false;\n\n      if (slot) {\n        var titems = [];\n        this.fitems.forEach(element => {\n          if (element[0] == slot) {\n            titems.push(element);\n          }\n        });\n        this.fitems = titems;\n      } else {\n        this.fitems = this.aitems;\n      }\n\n      this.updateDpsThresholds(this.fitems);\n    }\n\n    filtrar3(data) {\n      var player = data.target.value;\n\n      if (player) {\n        this.playerCargado = player;\n        this.bossCargado = '';\n        this.fitems = this.aitems;\n        var titems = [];\n        this.fitems.forEach(element => {\n          var telement = [];\n          element[1].forEach(datos => {\n            var sim = datos.sim;\n            var existe = sim.find(x => x.name.toLowerCase() == player.toLowerCase());\n\n            if (existe) {\n              telement.push(datos);\n            }\n          });\n          var tslot = [element[0], telement];\n          titems.push(tslot);\n        });\n        this.fitems = titems;\n        this.cargarActualIlvl(player);\n\n        if (this.checkDiv) {\n          this.checkIlvl();\n        }\n      } else {\n        this.actualIlvl = 0;\n        this.fitems = this.aitems;\n        this.playerCargado = '';\n      }\n\n      this.updateDpsThresholds(this.fitems);\n    }\n\n    filtrar4(data) {\n      this.checkDiv = false;\n      var dps = parseInt(data.target.value, 10);\n\n      if (!Number.isNaN(dps) && dps > 0) {\n        //this.fitems = this.aitems;\n        var titems = [];\n        this.fitems.forEach(element => {\n          var telement = [];\n          element[1].forEach(datos => {\n            var sim = datos.sim;\n            var existe = sim.find(x => x.dps >= dps);\n\n            if (existe) {\n              telement.push(datos);\n            }\n          });\n          var tslot = [element[0], telement];\n          titems.push(tslot);\n        });\n        this.fitems = titems;\n      } else {\n        this.fitems = this.aitems;\n      }\n    }\n\n    resetAll() {\n      this.fitems = this.aitems;\n      this.select.forEach(element => {\n        element.nativeElement.value = '';\n      });\n      this.actualIlvl = 0;\n      this.actualSpec = '';\n      this.playerCargado = '';\n      this.bossCargado = '';\n      this.checkDiv = false;\n      this.updateDpsThresholds(this.fitems);\n    }\n\n    checkIlvl() {\n      var resultado = this.playersLibrary.filter(x => x.name == this.playerCargado);\n\n      if (resultado.length > 1) {\n        const maxValues = resultado.reduce((acc, curr) => {\n          for (let key in curr) {\n            if (!acc[key]) {\n              acc[key] = curr[key];\n            } else {\n              acc[key] = Math.max(acc[key], curr[key]);\n            }\n          }\n\n          return acc;\n        }, {});\n        this.checkArray = maxValues;\n      } else {\n        this.checkArray = resultado[0];\n      }\n\n      this.checkDiv = true;\n    }\n\n    getArrayFromObject(obj) {\n      return Object.entries(obj).map(([key, value]) => ({\n        name: key,\n        value\n      }));\n    }\n\n    checkStyleIlvl(ilvl) {\n      var value = parseInt(ilvl);\n\n      if (value < 610) {\n        return 'red'; // Menor que 610 -> rojo\n      } else if (value >= 610 && value < 619) {\n        return 'orange'; // Entre 610 y 619 -> naranja\n      } else {\n        return 'black'; // Mayor o igual que 619 -> negro\n      }\n    }\n\n    cargarActualIlvl(player) {\n      var obj = this.playersLibrary.find(x => x.name.toLowerCase() == player.toLowerCase());\n      this.actualIlvl = obj.ilvl;\n      this.actualSpec = obj.spec;\n    }\n\n    comprobarCatalyst(data) {\n      var totalArray = [];\n      data.forEach(element => {\n        var tempArray = [];\n\n        if (this.comprobarSlotCatalyst(element[0])) {\n          element[1].forEach(item => {\n            var existe = false;\n\n            if (item.armor != 'Tier') {\n              tempArray.forEach(value => {\n                if (value) {\n                  if (value.armor == item.armor && value.boss == item.boss) {\n                    existe = true;\n                    var existeSim = false;\n                    value.sim.forEach(sim => {\n                      item.sim.forEach(itemSim => {\n                        if (sim.name == itemSim.name) {\n                          if (itemSim.dps > sim.dps) {\n                            sim.dps = itemSim.dps;\n                          }\n\n                          existeSim = true;\n                        }\n                      });\n                    });\n\n                    if (!existeSim) {\n                      value.sim.push(item.sim[0]);\n                    }\n\n                    value.exactID.push(item.id);\n                  }\n                }\n              });\n            }\n\n            if (!existe) {\n              tempArray.push(item);\n            }\n          });\n        } else {\n          tempArray = element[1];\n        }\n\n        totalArray.push([element[0], tempArray]);\n      });\n      return totalArray;\n    }\n\n    comprobarSlotCatalyst(slot) {\n      if (slot == 'trinket') {\n        return false;\n      }\n\n      if (slot == 'finger') {\n        return false;\n      }\n\n      if (slot == 'main_hand') {\n        return false;\n      }\n\n      if (slot == 'off_hand') {\n        return false;\n      }\n\n      return true;\n    }\n\n    getImgLink(id) {\n      var item = this.itemsLibrary.find(x => x.id == id);\n\n      if (!item) {\n        return this.PH_image;\n      } else {\n        var icon = this.base_img + item.icon + '.jpg';\n        return icon;\n      }\n    }\n\n    getRotation() {\n      this.checkDiv = true;\n      const idBoss = Number(this.bossCargado);\n      const allItemsFromBoss = [];\n      const playersByName = new Map();\n      this.playersLibrary.forEach(player => {\n        playersByName.set(String(player.name).toLowerCase(), player);\n      });\n      this.aitems.forEach(slot => {\n        if (!slot[1]) {\n          return;\n        }\n\n        slot[1].forEach(item => {\n          if (Number(item.boss) === idBoss) {\n            allItemsFromBoss.push(item);\n          }\n        });\n      });\n      this.allSimList = [];\n      this.playersLibrary.forEach(player => {\n        const playerKey = String(player.name).toLowerCase();\n        const playerItems = [];\n        allItemsFromBoss.forEach(item => {\n          const simForPlayer = item.sim?.find(sim => String(sim.name).toLowerCase() === playerKey);\n\n          if (!simForPlayer) {\n            return;\n          }\n\n          const exactId = Array.isArray(item.exactID) && item.exactID.length > 0 ? Number(item.exactID[0]) : Number(item.id);\n          const resolvedItemId = Number.isInteger(exactId) && exactId > 0 ? exactId : Number(item.id);\n          const libItem = this.itemsLibrary.find(x => Number(x.id) === resolvedItemId);\n          const simName = String(simForPlayer.name);\n          const knownPlayer = playersByName.get(String(simName).toLowerCase());\n          const resolvedSpec = knownPlayer?.spec || player.spec;\n          const resolvedName = this.capitalizeFirstLetter(simName);\n          playerItems.push({\n            name: libItem?.name || `Item ${resolvedItemId}`,\n            item: resolvedItemId,\n            bisItemId: resolvedItemId,\n            dps: Number(simForPlayer.dps),\n            pos: 0,\n            spec: resolvedSpec,\n            playerName: resolvedName\n          });\n        });\n        playerItems.sort((a, b) => b.dps - a.dps);\n        playerItems.forEach((entry, index) => {\n          entry.pos = index + 1;\n        });\n\n        if (playerItems.length > 0) {\n          this.allSimList.push(playerItems);\n        }\n      });\n    }\n\n    getColor(pos) {\n      if (pos == 1) {\n        return '#1f5a45';\n      }\n\n      if (pos == 2) {\n        return '#66531d';\n      }\n\n      if (pos == 3) {\n        return '#6d3f22';\n      }\n\n      return '#1b2640';\n    }\n\n    getRotacionBis(item) {\n      var bisList = this.allBisList.find(x => x[0] == this.limpiarSpec2(item.spec));\n      var id = Number(item.bisItemId ?? item.item);\n\n      if (bisList) {\n        var existe = false;\n        existe = bisList.find(x => Number(x) == id);\n\n        if (!existe) {\n          return 'red';\n        } else {\n          return 'black';\n        }\n      }\n\n      return 'black';\n    }\n\n    cargarRutaDroptimizer() {\n      const result = this.playersLibrary.filter(obj => obj.name === this.playerCargado);\n      window.open(result[0].report, '_blank');\n    }\n\n    getBisList(spec) {\n      return new Promise((resolve, reject) => {\n        this.RaidbotsApiService.getBisList(spec).subscribe(data => {\n          try {\n            var idItems = [];\n            var separator = 'WH.Gatherer.addData';\n            data = data.split(separator);\n            separator = 'qualityTier';\n            data = data[2].split(separator);\n            separator = '\\\"';\n            var arrayItems = [];\n            data.forEach(element => {\n              // Cada lista que esta incluida\n              if (element.includes(\"helm\")) {\n                if (arrayItems.length > 1) {\n                  idItems.push(arrayItems);\n                }\n\n                arrayItems = [];\n              }\n\n              var dato = element.split(separator);\n\n              if (dato.length > 2) {\n                var final;\n\n                if (dato[2] == ':{') {\n                  final = parseInt(dato[1].replace('\"', ''));\n                } else {\n                  final = parseInt(dato[2].replace('\"', ''));\n                }\n\n                arrayItems.push({\n                  id: final,\n                  slot: this.verSlot(element)\n                });\n              }\n            });\n            idItems.push(arrayItems);\n            resolve(this.estructurarItems(idItems, spec)); // Resolviendo la promesa con el resultado final\n          } catch (error) {\n            reject(error); // En caso de error\n          }\n        }, error => {\n          reject(error); // En caso de error en la suscripción\n        });\n      });\n    }\n\n    estructurarItems(idItems, spec) {\n      var itemList = [];\n      idItems[0].forEach(element => {\n        var obj = this.itemsLibrary.find(x => x.id === element.id);\n\n        if (obj) {\n          if (!itemList[element.slot]) {\n            itemList[element.slot] = [];\n          }\n\n          var newObj = obj;\n          newObj.overall = this.comprobarOverall(newObj, itemList[element.slot], element.slot);\n          itemList[element.slot].push(newObj);\n        } else {\n          var newObj = element;\n          newObj.overall = false;\n\n          if (!itemList[newObj.slot]) {\n            itemList[newObj.slot] = [];\n          }\n\n          itemList[newObj.slot].push(newObj);\n        }\n      });\n      return itemList;\n    }\n\n    comprobarOverall(item, itemList, slot) {\n      const filteredItems = itemList.filter(item => 'overall' in item);\n\n      if (slot == 'ring' || slot == 'trinket') {\n        if (filteredItems.length > 1) {\n          return false;\n        }\n      } else {\n        if (filteredItems.length > 0) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n\n    verSlot(item) {\n      // Inicializa una variable para determinar el slot correspondiente\n      let slot = 'trinket';\n\n      if (item.includes(\"helm\")) {\n        slot = 'head';\n      } else if (item.includes(\"neck\")) {\n        slot = 'neck';\n      } else if (item.includes(\"shoulder\")) {\n        slot = 'shoulder';\n      } else if (item.includes(\"cape\")) {\n        slot = 'back';\n      } else if (item.includes(\"chest\")) {\n        slot = 'chest';\n      } else if (item.includes(\"bracer\")) {\n        slot = 'wrist';\n      } else if (item.includes(\"glove\")) {\n        slot = 'hands';\n      } else if (item.includes(\"belt\")) {\n        slot = 'waist';\n      } else if (item.includes(\"boot\")) {\n        slot = 'feet';\n      } else if (item.includes(\"robe\") || item.includes(\"pants\") || item.includes(\"pant\")) {\n        slot = 'legs';\n      } else if (item.includes(\"ring\")) {\n        slot = 'ring';\n      } else if (item.includes(\"offhand\")) {\n        slot = 'off_hand';\n      } else if (item.includes(\"2h\") || item.includes(\"1h\")) {\n        slot = 'main_hand';\n      }\n\n      return slot;\n    }\n\n    getBisListData() {\n      this.LocalDataService.getBisListTxt().subscribe(data => {\n        var array = data.split(/\\r?\\n/);\n        array = this.splitArrayByEmpty(array);\n        this.allBisList = [];\n        array.forEach(element => {\n          var elementArray = [this.limpiarSpec(element[0])];\n          element.forEach(item => {\n            if (typeof item === 'number' || !isNaN(Number(item))) {\n              elementArray.push(item);\n            }\n          });\n          this.allBisList.push(elementArray);\n        });\n      });\n    }\n\n    limpiarSpec(str) {\n      const words = str.split(\" \"); // Divide la cadena en palabras\n\n      const lastWord = words.pop(); // Extrae la última palabra\n\n      if (lastWord) {\n        words.unshift(lastWord); // Coloca la última palabra al principio\n      } // Si hay más de 2 palabras, cambiar los espacios a guiones entre las palabras restantes\n\n\n      if (words.length > 1) {\n        return [words[0], words.slice(1).join(\"-\")].join(\" \"); // Únelo con guiones y coloca la última palabra al principio\n      }\n\n      return words.join(\" \"); // Si es solo una palabra, devuélvela tal cual\n    }\n\n    limpiarSpec2(str) {\n      const words = str.split(\" \"); // Divide la cadena en palabras\n\n      if (words.length > 2) {\n        // Si hay más de 2 palabras, conservamos la primera y reemplazamos los espacios entre las demás por guiones\n        const firstWord = words[0]; // Conservamos la primera palabra\n\n        const remainingWords = words.slice(1).join(\"-\"); // Unimos las palabras restantes con guiones\n\n        return `${firstWord} ${remainingWords}`; // Devolvemos el string con la primera palabra seguida por las demás unidas con guiones\n      }\n\n      return str; // Si hay dos o menos palabras, devolvemos el string tal como está\n    }\n\n    splitArrayByEmpty(arr) {\n      const result = []; // Array que contendrá los grupos\n\n      let currentGroup = []; // Grupo actual que estamos construyendo\n\n      for (const item of arr) {\n        if (item === '') {\n          // Si encontramos un elemento vacío, añadimos el grupo actual al resultado\n          if (currentGroup.length > 0) {\n            result.push(currentGroup);\n            currentGroup = []; // Reiniciar el grupo actual\n          }\n        } else {\n          // Si no es un elemento vacío, lo añadimos al grupo actual\n          currentGroup.push(item);\n        }\n      } // Añadir el último grupo si existe\n\n\n      if (currentGroup.length > 0) {\n        result.push(currentGroup);\n      }\n\n      return result;\n    }\n\n    cargarTiersPlayer() {\n      this.tierSlots = [];\n      this.playersLibrary.forEach(element => {\n        var player = element.name;\n        this.bossCargado = '';\n        var titems = [];\n        this.aitems.forEach(element => {\n          var telement = [];\n          element[1].forEach(datos => {\n            var sim = datos.sim;\n            var existe = sim.find(x => x.name.toLowerCase() == player.toLowerCase());\n\n            if (existe) {\n              telement.push(datos);\n            }\n          });\n          var tslot = [element[0], telement];\n          titems.push(tslot);\n        });\n        titems.forEach(slot => {\n          if ((slot[0] == 'head' || slot[0] == 'shoulder' || slot[0] == 'chest' || slot[0] == 'hands' || slot[0] == 'legs') && slot[1].length > 0) {\n            var gearSims = slot[1];\n            gearSims.forEach(item => {\n              if (item.armor == 'Tier') {\n                this.tierSlots.push({\n                  name: player,\n                  armor: this.getArmor(element.spec, 'head'),\n                  tier: [{\n                    slot: slot[0],\n                    sim: item.sim\n                  }]\n                });\n              }\n            });\n          }\n        });\n      });\n      this.aitems.forEach(slot => {\n        if ((slot[0] === 'head' || slot[0] === 'shoulder' || slot[0] === 'chest' || slot[0] === 'hands' || slot[0] === 'legs') && slot[1].length > 0) {\n          var gearSims = slot[1];\n          gearSims.forEach(item => {\n            if (item.armor !== 'Tier') {\n              item.sim = item.sim.map(sim => this.catalyst(slot[0], sim));\n            }\n          });\n        }\n      });\n    }\n\n    catalyst(slot, sim) {\n      var player = sim.name;\n      const results = this.tierSlots.find(x => x.name.toLowerCase() === player.toLowerCase());\n      const tierResults = results.tier.find(x => x.slot === slot);\n      var tierSim = tierResults.sim[0];\n      var newSim = sim;\n\n      if (tierSim.dps > sim.dps) {\n        newSim.dps = tierSim.dps;\n      }\n\n      return newSim;\n    }\n\n    goBises() {\n      this.router.navigate(['/bises']);\n    }\n\n  }\n\n  MainComponent.ɵfac = function MainComponent_Factory(t) {\n    return new (t || MainComponent)(i0.ɵɵdirectiveInject(i1.HttpClient), i0.ɵɵdirectiveInject(i2.RaidbotsApiService), i0.ɵɵdirectiveInject(i3.LocalDataService), i0.ɵɵdirectiveInject(i4.DiscordApiService), i0.ɵɵdirectiveInject(i5.Router));\n  };\n\n  MainComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: MainComponent,\n    selectors: [[\"app-main\"]],\n    viewQuery: function MainComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.select = _t);\n      }\n    },\n    features: [i0.ɵɵProvidersFeature([RaidbotsApiService])],\n    decls: 33,\n    vars: 13,\n    consts: [[1, \"main-page\"], [1, \"top-panel\"], [1, \"panel-title\"], [1, \"title-row\"], [1, \"date-badge\"], [1, \"status-row\"], [1, \"stat-pill\"], [\"class\", \"stat-pill\", 4, \"ngIf\"], [1, \"filters-grid\"], [\"name\", \"Bosses\", \"id\", \"bosses\", 3, \"change\"], [\"myselect\", \"\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"name\", \"Slots\", \"id\", \"slots\", 3, \"change\", 4, \"ngIf\"], [\"name\", \"DPS\", \"id\", \"players\", 3, \"change\", 4, \"ngIf\"], [\"name\", \"Players\", \"id\", \"players\", 3, \"change\", 4, \"ngIf\"], [1, \"actions-row\"], [1, \"btn\", \"ghost\", 3, \"click\"], [\"class\", \"btn ghost\", 3, \"click\", 4, \"ngIf\"], [1, \"btn\", \"primary\", 3, \"click\"], [\"class\", \"cards-grid\", 4, \"ngIf\"], [\"class\", \"rotation-grid\", 4, \"ngIf\"], [3, \"value\"], [\"name\", \"Slots\", \"id\", \"slots\", 3, \"change\"], [\"name\", \"DPS\", \"id\", \"players\", 3, \"change\"], [\"name\", \"Players\", \"id\", \"players\", 3, \"change\"], [1, \"cards-grid\"], [4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [\"class\", \"loot-card\", 4, \"ngFor\", \"ngForOf\"], [1, \"loot-card\"], [1, \"loot-header\"], [\"alt\", \"item icon\", 3, \"src\"], [1, \"loot-meta\"], [1, \"chart-wrap\"], [\"baseChart\", \"\", 3, \"data\", \"options\", \"type\"], [1, \"rotation-grid\"], [\"class\", \"rotation-card\", 4, \"ngFor\", \"ngForOf\"], [1, \"rotation-card\"], [\"class\", \"rotation-item\", 3, \"ngStyle\", 4, \"ngFor\", \"ngForOf\"], [1, \"rotation-item\", 3, \"ngStyle\"]],\n    template: function MainComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"main\", 0)(1, \"section\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"h1\");\n        i0.ɵɵtext(5, \"Skill Issue Droptimizers\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"span\", 4);\n        i0.ɵɵtext(7);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(8, \"p\");\n        i0.ɵɵtext(9, \"Droptimizer insights and upgrade priority by boss, slot and player.\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(10, \"div\", 5)(11, \"span\", 6);\n        i0.ɵɵtext(12);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(13, MainComponent_span_13_Template, 2, 2, \"span\", 7);\n        i0.ɵɵtemplate(14, MainComponent_span_14_Template, 2, 0, \"span\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(15, \"div\", 8)(16, \"select\", 9, 10);\n        i0.ɵɵlistener(\"change\", function MainComponent_Template_select_change_16_listener($event) {\n          return ctx.filtrar($event);\n        });\n        i0.ɵɵelementStart(18, \"option\", 11);\n        i0.ɵɵtext(19, \"Bosses\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(20, MainComponent_option_20_Template, 2, 2, \"option\", 12);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(21, MainComponent_select_21_Template, 5, 1, \"select\", 13);\n        i0.ɵɵtemplate(22, MainComponent_select_22_Template, 5, 1, \"select\", 14);\n        i0.ɵɵtemplate(23, MainComponent_select_23_Template, 5, 1, \"select\", 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(24, \"div\", 16)(25, \"button\", 17);\n        i0.ɵɵlistener(\"click\", function MainComponent_Template_button_click_25_listener() {\n          return ctx.goBises();\n        });\n        i0.ɵɵtext(26, \"Bises\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(27, MainComponent_button_27_Template, 2, 0, \"button\", 18);\n        i0.ɵɵtemplate(28, MainComponent_button_28_Template, 2, 0, \"button\", 18);\n        i0.ɵɵelementStart(29, \"button\", 19);\n        i0.ɵɵlistener(\"click\", function MainComponent_Template_button_click_29_listener() {\n          return ctx.resetAll();\n        });\n        i0.ɵɵtext(30, \"Reset\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵtemplate(31, MainComponent_section_31_Template, 2, 1, \"section\", 20);\n        i0.ɵɵtemplate(32, MainComponent_section_32_Template, 2, 1, \"section\", 21);\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(7);\n        i0.ɵɵtextInterpolate(ctx.weekRangeLabel);\n        i0.ɵɵadvance(5);\n        i0.ɵɵtextInterpolate2(\"\", ctx.playersLibrary.length, \" / \", ctx.reports.length, \" reports\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.actualIlvl);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.checkDiv);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngForOf\", ctx.encounterLibrary);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.checkDiv);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.checkDiv);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.checkDiv);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", ctx.playerCargado);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.bossCargado && !ctx.checkDiv);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", !ctx.checkDiv);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.checkDiv);\n      }\n    },\n    dependencies: [i6.NgForOf, i6.NgIf, i6.NgStyle, i7.NgSelectOption, i7.ɵNgSelectMultipleOption, i8.BaseChartDirective],\n    styles: [\".main-page[_ngcontent-%COMP%]{width:min(1400px,95vw);margin:2rem auto 3rem;display:grid;gap:1.25rem}.top-panel[_ngcontent-%COMP%]{background:linear-gradient(130deg,#1a2133 0%,#222b42 60%,#1f3633 100%);border:1px solid #2c3651;border-radius:18px;box-shadow:0 20px 40px #02040b80;padding:1.25rem;display:grid;gap:1rem}.title-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem}.panel-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:clamp(1.5rem,2vw,2.2rem);letter-spacing:.02em;color:#f4f7ff}.date-badge[_ngcontent-%COMP%]{background:#0f1729;border:1px solid #3f4f77;color:#dbe7ff;border-radius:999px;padding:.35rem .75rem;font-weight:700;font-size:.87rem}.panel-title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.35rem 0 0;color:#b7c4e4;font-size:.98rem}.status-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.6rem}.stat-pill[_ngcontent-%COMP%]{background:#101a2f;color:#dbe8ff;padding:.4rem .75rem;border-radius:999px;font-size:.85rem;font-weight:600;border:1px solid #304262}.filters-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,minmax(170px,1fr));gap:.75rem}select[_ngcontent-%COMP%]{width:100%;border:1px solid #3a496c;border-radius:12px;background:#111a2d;color:#e6eeff;padding:.7rem .8rem;font-size:.95rem;font-weight:600}select[_ngcontent-%COMP%]:focus{outline:2px solid #6ea8ff;outline-offset:2px}.actions-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.6rem;justify-content:flex-end}.btn[_ngcontent-%COMP%]{border:0;border-radius:12px;padding:.62rem .9rem;font-size:.92rem;font-weight:700;cursor:pointer;transition:transform .15s ease,opacity .15s ease}.btn[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.btn.primary[_ngcontent-%COMP%]{background:#f08a3d;color:#fffdf9}.btn.ghost[_ngcontent-%COMP%]{background:#121b30;color:#e1ebff;border:1px solid #354567}.cards-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:1rem}.loot-card[_ngcontent-%COMP%]{background:#161f33;border:1px solid #2d3853;border-radius:16px;padding:1rem;box-shadow:0 10px 25px #02040c73;display:grid;gap:.8rem}.loot-header[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:center}.loot-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:54px;height:54px;border-radius:10px;border:1px solid #3a486a;background:#10182a}.loot-meta[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.05rem;color:#f2f6ff}.loot-meta[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.2rem 0 0;color:#b4c4e6;font-size:.88rem}.chart-wrap[_ngcontent-%COMP%]{background:#10192b;border:1px solid #314262;border-radius:12px;padding:.45rem .65rem}.rotation-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1rem}.rotation-card[_ngcontent-%COMP%]{background:#161f33;border:1px solid #2d3853;border-radius:14px;overflow:hidden;box-shadow:0 10px 25px #02040c73}.rotation-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.55rem;padding:.7rem;border-bottom:1px dashed rgba(255,255,255,.2);font-weight:700}.rotation-item[_ngcontent-%COMP%]:last-child{border-bottom:0}.rotation-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:8px}@media (max-width: 900px){.filters-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(150px,1fr))}.cards-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media (max-width: 560px){.main-page[_ngcontent-%COMP%]{width:94vw}.filters-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.actions-row[_ngcontent-%COMP%]{justify-content:stretch}.btn[_ngcontent-%COMP%]{flex:1}.title-row[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}\"]\n  });\n  return MainComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}